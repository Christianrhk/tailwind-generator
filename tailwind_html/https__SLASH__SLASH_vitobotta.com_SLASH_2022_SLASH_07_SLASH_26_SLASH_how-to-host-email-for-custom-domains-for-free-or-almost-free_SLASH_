<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="UTF-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> <link rel="preconnect" href="https://cdn.dynablogger.com" crossorigin> <link rel="preconnect" href="https://cdn.commento.io" crossorigin> <script defer data-domain="vitobotta.com" src="https://pl.skylinx.workers.dev/blah.js"></script> <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://vitobotta.com/feed.rss"> <link as="style" href="https://cdn.dynablogger.com/stylesheets/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/wA3w/karla.css" rel="preload"> <link href="https://cdn.dynablogger.com/stylesheets/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/wA3w/karla.css" media="print" onload="this.media='all'" rel="stylesheet"> <noscript> <link href="https://cdn.dynablogger.com/stylesheets/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/wA3w/karla.css" rel="stylesheet"> </noscript> <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.6.2/tailwind.min.css" rel="stylesheet"> <link href="https://cdn.dynablogger.com/stylesheets/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/Oby0/main.css" rel="stylesheet"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css" rel="stylesheet"> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script> <script defer src="https://commento.botta.me/js/commento.js"></script> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <title>How to host email for custom domains for free (or almost free)</title> <meta name="generator" content="DynaBlogger"> <meta name="author" content="Vito Botta"> <meta name="description" content="How to use Cloudflare Email Routing and a free Gmail account to cut email hosting costs to zero."> <link rel="canonical" href="https://vitobotta.com/2022/07/26/how-to-host-email-for-custom-domains-for-free-or-almost-free/"> <link rel="alternate" hreflang="en" href="https://vitobotta.com/2022/07/26/how-to-host-email-for-custom-domains-for-free-or-almost-free/"> <link rel="alternate" hreflang="x-default" href="https://vitobotta.com/2022/07/26/how-to-host-email-for-custom-domains-for-free-or-almost-free/"> <meta property="og:title" content="How to host email for custom domains for free (or almost free)"> <meta property="og:type" content="article"> <meta property="og:url" content="https://vitobotta.com/2022/07/26/how-to-host-email-for-custom-domains-for-free-or-almost-free/"> <meta property="og:description" content="How to use Cloudflare Email Routing and a free Gmail account to cut email hosting costs to zero."> <meta property="og:locale" content="en"> <meta property="og:site_name" content="has_many :codes"> <meta property="article:tag" content="email"> <meta property="article:tag" content="cloudflare"> <meta property="article:tag" content="Google"> <meta name="document_id" content="xv1e"> <meta name="document_type" content="posts"> <link data-behaviour="comments" rel="stylesheet" href="https://cdn.dynablogger.com/comments/6M/01b373495c826b5f2dc31e0b9b13e640/stylesheet.css"> <script data-behaviour="comments" src="https://cdn.dynablogger.com/comments/6M/01b373495c826b5f2dc31e0b9b13e640/script.js"></script> </head> <body> <div class="w-full text-center px-8 py-4 bg-blue-600 text-white"> <div class="w-64 mx-auto flex items-center justify-center justify-between text-lg no-underline text-white"> <a class="hidden" href="#"> <svg aria-hidden="true" class="fab fa-facebook h-6 w-6" data-fa-i2svg="" data-icon="facebook" data-prefix="fab" focusable="false" role="img" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"> <path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z" fill="currentColor"></path> </svg> </a> <a class="hidden ml-4 lg:ml-6" href="#"> <svg aria-hidden="true" class="fab fa-instagram h-6 w-6" data-fa-i2svg="" data-icon="instagram" data-prefix="fab" focusable="false" role="img" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"> <path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z" fill="currentColor"></path> </svg> </a> <a class="ml-4 lg:ml-6" href="https://twitter.com/vitobotta" title="Twitter" target="_blank"> <svg aria-hidden="true" class="fab fa-twitter h-6 w-6" data-fa-i2svg="" data-icon="twitter" data-prefix="fab" focusable="false" role="img" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"> <path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" fill="currentColor"></path> </svg> </a> <a class="ml-4 lg:ml-6" href="https://www.linkedin.com/in/vitobotta/" title="LinkedIn" target="_blank"> <svg aria-hidden="true" class="h-6 w-6" data-fa-i2svg="" data-icon="linkedin" data-prefix="fab" focusable="false" role="img" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"> <path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z" fill="currentColor"></path> </svg> </a> <a class="ml-4 lg:ml-6" href="https://github.com/vitobotta" title="Github" target="_blank"> <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewbox="-6.39108 -10.38875 55.38936 62.3325"><g fill="#fff"> <path d="M21.3035 0C9.5395 0 0 9.5373 0 21.3035c0 9.4122 6.1041 17.3976 14.5687 20.2146 1.0646.1972 1.4555-.4622 1.4555-1.0249 0-.5076-.0198-2.1861-.0289-3.9662-5.9266 1.2887-7.1772-2.5136-7.1772-2.5136-.9691-2.462-2.3654-3.1171-2.3654-3.1171-1.9329-1.3222.1457-1.295.1457-1.295 2.1392.1502 3.2656 2.1956 3.2656 2.1956 1.9001 3.2565 4.9837 2.315 6.1994 1.7706.1916-1.3765.7433-2.3167 1.3526-2.8487-4.7319-.5383-9.706-2.3653-9.706-10.5283 0-2.3255.8322-4.2259 2.195-5.7178-.2212-.537-.9504-2.7037.2067-5.638 0 0 1.789-.5723 5.8596 2.184 1.6994-.472 3.5218-.7088 5.3323-.7172 1.8104.008 3.6343.2451 5.3368.7172 4.0661-2.7563 5.8526-2.184 5.8526-2.184 1.1596 2.9343.4304 5.101.2092 5.638 1.366 1.4919 2.1921 3.3923 2.1921 5.7178 0 8.1827-4.9837 9.984-9.7275 10.5114.7642.6611 1.445 1.9576 1.445 3.9451 0 2.8505-.0243 5.1446-.0243 5.8462 0 .5673.3831 1.2316 1.463 1.0224 8.4603-2.8201 14.5566-10.8028 14.5566-20.212C42.6071 9.5372 33.0691 0 21.3036 0" fill-rule="evenodd"></path><path d="M8.0689 30.587c-.047.1061-.2135.1379-.3651.0649-.155-.0695-.2413-.2138-.1913-.32.046-.1087.2124-.139.367-.0663.1545.0695.2426.2152.1894.3214m.863.9625c-.1016.0942-.3006.0504-.435-.0984-.1397-.1485-.1655-.3475-.0624-.4427.1048-.0942.2974-.0501.4367.0984.1397.1503.1669.3475.0607.4427m.8399 1.2268c-.1305.091-.3443.006-.4763-.1834-.1305-.1898-.1305-.417.003-.508.132-.091.3426-.009.4763.1788.1302.1926.1302.4198-.003.5126m1.1506 1.1855c-.1167.1287-.3654.0942-.5475-.0815-.1862-.1718-.238-.4156-.1213-.5444.1185-.129.3686-.0928.552.0815.185.1715.241.417.1168.5444m1.5876.6882c-.052.167-.291.2424-.5324.1715-.241-.073-.3986-.268-.35-.4367.0502-.1683.2908-.247.5338-.1711.2406.0727.3987.2667.3486.4364m1.7435.1275c.006.1757-.1986.3214-.4519.3245-.2547.006-.461-.1365-.4639-.3094 0-.1774.2004-.3213.4547-.326.2533-.005.4611.1366.4611.3109m1.6223-.276c.0303.171-.1457.3471-.3972.394-.2473.0455-.4763-.0607-.5077-.2303-.0307-.1757.1482-.3517.3955-.3972.2519-.0437.4773.0593.5094.2335"></path></g> </svg> </a> <a class="ml-4 lg:ml-6" href="/feed.xml" title="Github" target="_blank"> <svg version="1.1" id="Layer_1" class="h-8 w-8 bg-blue-600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"> <g> <path style="fill:#FCFCFC;" d="M155.826,401.252c-24.856,0-45.078-20.222-45.078-45.078c0-24.856,20.222-45.078,45.078-45.078 s45.078,20.222,45.078,45.078C200.904,381.03,180.683,401.252,155.826,401.252z"></path> <path style="fill:#FCFCFC;" d="M249.878,387.908v-10.041c0-63.924-51.821-115.744-115.744-115.744h-10.041 c-1.223,0-2.214-0.992-2.214-2.214v-57.902c0-1.223,0.992-2.214,2.214-2.214h10.041c98.349,0,178.075,79.727,178.075,178.075 v10.041c0,1.223-0.992,2.214-2.214,2.214h-57.902C250.87,390.122,249.878,389.13,249.878,387.908z"></path> <path style="fill:#FCFCFC;" d="M361.183,387.908v-10.041c0-125.395-101.653-227.049-227.049-227.049h-10.041 c-1.223,0-2.214-0.992-2.214-2.214V90.701c0-1.223,0.992-2.214,2.214-2.214h12.255c76.705,0,148.818,29.87,203.057,84.108 c54.239,54.239,84.108,126.352,84.108,203.057v12.256c0,1.223-0.992,2.214-2.214,2.214h-57.902 C362.174,390.122,361.183,389.13,361.183,387.908z"></path> </g> </svg> </a> </div> </div> <div class="w-full text-center p-4 sm:p-8 bg-white"> <div class="text-4xl sm:text-5xl xl:text-6xl text-gray-800 font-semibold"> has_many :codes </div> <div class="mt-2 lg:mt-4 text-xl sm:text-2xl xl:text-3xl text-gray-600">Tips and walkthroughs on web technologies and digital life</div> </div> <div class="w-full text-center p-4 sm:p-8 bg-gray-200 border border-gray-300 border-l-0 border-r-0 mb-8 sm:text-xl"> <ul class="list-none mx-auto w-full max-w-lg flex justify-center flex-wrap"> <li> <a class="uppercase text-xl mx-6" href="/">Home</a> </li> <li> <a class="uppercase text-xl mx-6" href="https://vitobotta.com/about/">About</a> </li> <li> <a class="uppercase text-xl mx-6" href="https://vitobotta.com/geeky-cv/">Geeky CV</a> </li> <li> <a class="uppercase text-xl mx-6" href="https://vitobotta.com/search/">Search</a> </li> </ul> </div> <div class="flex text-lg justify-center"> <main class="px-4 sm:px-8 pb-4 sm:max-w-full w-full lg:max-w-3xl xl:max-w-4xl"> <article class="lg:mb-12 border border-gray-200 rounded shadow-lg p-6 bg-white"> <header> <span class="md:flex"> <div class="uppercase mb-2"> <a class="text-blue-500 text-sm sm:text-base lg:text-lg" href="https://vitobotta.com/tags/email/">email</a> • <a class="text-blue-500 text-sm sm:text-base lg:text-lg" href="https://vitobotta.com/tags/cloudflare/">cloudflare</a> • <a class="text-blue-500 text-sm sm:text-base lg:text-lg" href="https://vitobotta.com/tags/google/">Google</a> </div> </span> <h1 class="mt-3 text-2xl sm:text-3xl xl:text-4xl flex items-center"> <a href="https://vitobotta.com/2022/07/26/how-to-host-email-for-custom-domains-for-free-or-almost-free/" class="document-title font-semibold"> How to host email for custom domains for free (or almost free) </a> </h1> <div class="mt-4 flex justify-between"> <div class="text-gray-700 flex items-center text-base sm:text-lg"> <img src="https://cdn.dynablogger.com/static/blobs/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBdXcxIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--32dd40b68b9e9d86bb617ff9b756a850aa20cc59/calendar.png" class="hidden lg:block"> <div class="hidden lg:block ml-2 mt-1"> Published <time>Tuesday, Jul 26 2022</time> </div> </div> <div class="hidden lg:block"> <a href="#commento-wrapper" class="underline mt-1">Jump to comments</a> </div> </div> <div class="lg:hidden text-base sm:text-lg flex items-center"> <img src="https://cdn.dynablogger.com/static/blobs/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBdXcxIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--32dd40b68b9e9d86bb617ff9b756a850aa20cc59/calendar.png" class="mr-2"> Published   <time>Tuesday, Jul 26 2022</time> </div> </header> <section class="mt-8"> <p class="text-xl"> </p> <div class="trix-content"> <div> <strong>Update July 27, 2022</strong>: I have read quite a bit on the risks of this kind of setup potentially affecting the reputation of your custom domains, so I feel obliged to leave a note about it. Emails forwarded by Cloudflare the way I describe in this post are seen by clients as "mailed by" my own custom domain. The problem with that is that if I flag an email I have received that way as spam, Google sees that the email was sent by my domain and therefore the action might affect the reputation of my domain. I couldn't find a conclusive confirmation if that's the case / if it's an actual problem, but to be honest I don't want to risk at this stage so I decided to stick with paid email hosting for my domains for the time being. Only difference is that I went with <a href="https://mxroute.com/">MX Route</a> instead of Zoho this time.<br><br>There are many options for hosting email for custom domains cheaply these days; one of such services is <a href="https://www.zoho.com/mail/">Zoho</a> which I have used for the past several months after <a href="https://workspace.google.com/">Google Workspace</a>, <a href="https://www.fastmail.com/">Fastmail</a> and even self hosted email with <a href="https://mailcow.email/">Mailcow</a>  on Docker. Zoho is a pretty good service and it's very cheap, but anyway if you have several custom domains the cost adds up.<br><br>Since I am cutting costs with my subscriptions, I was looking for a cheaper way to host email for several domains. I came across the<a href="https://developers.cloudflare.com/email-routing/"> Cloudflare Email Routing</a> service and I decided to give it a try.<br><br>Cloudflare's service does <em>not</em> host your email, but it allows you to create forwarding routes to route any incoming email to your custom domain to <em>existing</em> email addresses you already have. This means that I can receive emails sent to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="691f001d06290a1c1a1d06040d0604080007470a0604">[email&#160;protected]</a> in an existing inbox. In my case I am using free Gmail accounts for this. <br><br>So Cloudflare handles <em>receiving</em> emails, Gmail (or other free email hosting service) handled <em>storing</em> them for me, what about <em>sending </em>emails from a custom domain with this setup?<br><br>For this you have two options. The simplest is to just use Gmail's own SMTP servers to send emails as if they were sent from your custom domain. The downside of this is that some email clients will show some banner saying "sent via gmail.com" or something like that next to the sender address, so you may not like that.<br><br>A better option is to use an <strong>SMTP relay</strong><strong><em>. </em></strong>For this, we can use any service that operates the delivery of <em>transactional</em> email. These services are usually used to send automated emails from applications, such as confirmation emails on sign up, password recovery emails and the like, but they can work just fine for our purpose too.<br><br>If you want to cut the email hosting costs completely to zero there are some of such providers who have a free tier. For example, <a href="https://www.mailjet.com/">Mailjet</a> allows you to send up to 200 emails per day from your custom domains; I think <a href="https://www.sendinblue.com/">Sendinblue</a> has an even more generous free tier. Personally I opted for <a href="https://www.zoho.com/zeptomail/">ZeptoMail</a>, a competitor from Zoho. I need to pay a minimum of 2.50 euros per credit, but each credit lasts <strong>6 months</strong> and allows sending up to a whopping 10K emails. So it's not completely free but it's so cheap and with<em> </em>much higher limits, so I went with this one.<br><br> </div> <h2>Setting up email routing in Cloudflare</h2> <div>The first thing you'll need to do is enable email routing for your domain(s) and create one or more forwarding routes. This requires, unfortunately, that you use Cloudflare to host the DNS configuration for your domains, but there are plenty of good reasons why you would want to do that anyway these days (if you are not familiar with the service, I recommend you take a look at <a href="https://www.cloudflare.com/en-gb/">their website</a> to see all the features they have to offer besides DNS. Cloudflare is also wildly popular as CDN.<br><br>In this post I'll assume you are able to create an account with Cloudflare, and migrate your domains to it for the DNS part. It's a very easy process and completely guided, so I am not going into how to do that here.<br><br>Once the domain is migrated to Cloudflare, select "Email" from the sidebar:<br><br><br><action-text-attachment sgid="BAh7CEkiCGdpZAY6BkVUSSI7Z2lkOi8vZHluYWJsb2dnZXIvQWN0aXZlU3RvcmFnZTo6QmxvYi8xMzk5ND9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--7ab845c4a8c9375b5540b33c48072819c8508fa9" content-type="image/png" url="https://db.botta.me/static/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcW8yIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--88fbb0b4cc6fd086a1a04df4f95ef0b1ea3ccb42/01.%20Cloudflare%20Email%20Routing%20option%20in%20sidebar.png" filename="01. Cloudflare Email Routing option in sidebar.png" filesize="82106" width="520" height="726" previewable="true" presentation="gallery"><figure class="attachment attachment--preview attachment--png"> <img src="https://cdn.dynablogger.com/static/representations/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcW8yIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--88fbb0b4cc6fd086a1a04df4f95ef0b1ea3ccb42/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VY21WemFYcGxYM1J2WDJ4cGJXbDBXd2RwQWdBRWFRSUFBdz09IiwiZXhwIjpudWxsLCJwdXIiOiJ2YXJpYXRpb24ifX0=--62254c805d18962f1ac85d0730cb52228a017fca/01.%20Cloudflare%20Email%20Routing%20option%20in%20sidebar.png"> <figcaption class="attachment__caption"> <span class="attachment__name">01. Cloudflare Email Routing option in sidebar.png</span> <span class="attachment__size">80.2 KB</span> </figcaption> </figure></action-text-attachment><br><br><br>If the domain was previously configured to accept incoming email, it will already have one or more MX records, so you will see a screen similar to this:<br><br><action-text-attachment sgid="BAh7CEkiCGdpZAY6BkVUSSI7Z2lkOi8vZHluYWJsb2dnZXIvQWN0aXZlU3RvcmFnZTo6QmxvYi8xMzk5NT9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--d4d1b05b24bd70199107ed6128b54728440c6d06" content-type="image/png" url="https://db.botta.me/static/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcXMyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--812bb9bea8b12c8916decb9ce62de39b45e5049c/02.%20New%20MX%20records.png" filename="02. New MX records.png" filesize="256673" width="734" height="768" previewable="true" presentation="gallery"><figure class="attachment attachment--preview attachment--png"> <img src="https://cdn.dynablogger.com/static/representations/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcXMyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--812bb9bea8b12c8916decb9ce62de39b45e5049c/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VY21WemFYcGxYM1J2WDJ4cGJXbDBXd2RwQWdBRWFRSUFBdz09IiwiZXhwIjpudWxsLCJwdXIiOiJ2YXJpYXRpb24ifX0=--62254c805d18962f1ac85d0730cb52228a017fca/02.%20New%20MX%20records.png"> <figcaption class="attachment__caption"> <span class="attachment__name">02. New MX records.png</span> <span class="attachment__size">251 KB</span> </figcaption> </figure></action-text-attachment><br><br>If that's the case, go first to the DNS settings for the domain, delete the existing MX records, then come back to the email settings and click <em>Add records and enable</em>. In a short time you should see a confirmation that the DNS is configured:<br><action-text-attachment sgid="BAh7CEkiCGdpZAY6BkVUSSI7Z2lkOi8vZHluYWJsb2dnZXIvQWN0aXZlU3RvcmFnZTo6QmxvYi8xMzk5Nj9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--9d77a052f903c3d20991e47e3a4263b5c9a7172b" content-type="image/png" url="https://db.botta.me/static/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcXcyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--24779ffe1d62b910f0b88edc9ec14fa5914b9198/03.%20Confirmation%20of%20DNS%20settings.png" filename="03. Confirmation of DNS settings.png" filesize="123714" width="1024" height="341" previewable="true" presentation="gallery"><figure class="attachment attachment--preview attachment--png"> <img src="https://cdn.dynablogger.com/static/representations/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcXcyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--24779ffe1d62b910f0b88edc9ec14fa5914b9198/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VY21WemFYcGxYM1J2WDJ4cGJXbDBXd2RwQWdBRWFRSUFBdz09IiwiZXhwIjpudWxsLCJwdXIiOiJ2YXJpYXRpb24ifX0=--62254c805d18962f1ac85d0730cb52228a017fca/03.%20Confirmation%20of%20DNS%20settings.png"> <figcaption class="attachment__caption"> <span class="attachment__name">03. Confirmation of DNS settings.png</span> <span class="attachment__size">121 KB</span> </figcaption> </figure></action-text-attachment><br><br><br>You can ignore the "3 Destination addresses" here. It's because I had already configured some before configuring the domain in these pictures. Next, click on <em>Routes, </em>then <em>Add destination address, </em>and enter the email address you want incoming email for your custom domain to be forwarded to. This can be a Gmail address or any other free email service. <br><br>Cloudflare will send an email to the target address with a link to confirm it. Click on it, then once verified/confirmed go to the <em>Routes</em> panel again, and click <em>Create address</em>:<br><br><action-text-attachment sgid="BAh7CEkiCGdpZAY6BkVUSSI7Z2lkOi8vZHluYWJsb2dnZXIvQWN0aXZlU3RvcmFnZTo6QmxvYi8xMzk5Nz9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--50d4715aad96b50afe48eedb290ddac08e4035b5" content-type="image/png" url="https://db.botta.me/static/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcTAyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--649fefa16a032a287b8d54a2910a8e925b3322ce/04.%20Creating%20route.png" filename="04. Creating route.png" filesize="330999" width="1454" height="722" previewable="true" presentation="gallery"><figure class="attachment attachment--preview attachment--png"> <img src="https://cdn.dynablogger.com/static/representations/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcTAyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--649fefa16a032a287b8d54a2910a8e925b3322ce/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VY21WemFYcGxYM1J2WDJ4cGJXbDBXd2RwQWdBRWFRSUFBdz09IiwiZXhwIjpudWxsLCJwdXIiOiJ2YXJpYXRpb24ifX0=--62254c805d18962f1ac85d0730cb52228a017fca/04.%20Creating%20route.png"> <figcaption class="attachment__caption"> <span class="attachment__name">04. Creating route.png</span> <span class="attachment__size">323 KB</span> </figcaption> </figure></action-text-attachment><br><br><br>Enter the username for the email for the custom domain (dynablogger.com in this example), as well as the target address. As soon as the MX records are propagated, any incoming email sent to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="037670667143607670776c6e676c6e626a6d2d606c6e">[email&#160;protected]</a> will be forwarded to the target address.<br><br> </div> <h2>Sending emails as from the custom domain</h2> <div>So far we are able to receive incoming emails for the custom domain to some free email accounts such as Gmail. However, any emails sent from the Gmail/etc account will be seen by the receiver as coming from Google, not our custom domain. To fix this, we need to configure Gmail or equivalent to send emails as if from the custom domain address. We need to create an <em>alias</em> basically. I'll show here how to do it with Gmail, but the process will be very similar with other providers.<br><br>In Gmail, go to <em>Settings</em> &gt; <em>Accounts and Import </em>and click on <em>Add another email address</em> under <em>Send email as</em>. <br><br><action-text-attachment sgid="BAh7CEkiCGdpZAY6BkVUSSI7Z2lkOi8vZHluYWJsb2dnZXIvQWN0aXZlU3RvcmFnZTo6QmxvYi8xMzk5OD9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--0ceeca556479a743c67cceef1decc27bbde10b8a" content-type="image/png" url="https://db.botta.me/static/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcTQyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--2f2601039f3ccf14a8c26115aaafe014c8e8502c/05.%20SMTP%20step%201.png" filename="05. SMTP step 1.png" filesize="33467" width="417" height="225" previewable="true" presentation="gallery"><figure class="attachment attachment--preview attachment--png"> <img src="https://cdn.dynablogger.com/static/representations/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcTQyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--2f2601039f3ccf14a8c26115aaafe014c8e8502c/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VY21WemFYcGxYM1J2WDJ4cGJXbDBXd2RwQWdBRWFRSUFBdz09IiwiZXhwIjpudWxsLCJwdXIiOiJ2YXJpYXRpb24ifX0=--62254c805d18962f1ac85d0730cb52228a017fca/05.%20SMTP%20step%201.png"> <figcaption class="attachment__caption"> <span class="attachment__name">05. SMTP step 1.png</span> <span class="attachment__size">32.7 KB</span> </figcaption> </figure></action-text-attachment> </div> <div> <br>Enter your display name as well as the email address for the custom domain (that you want to send emails as), and in the next step configure the SMTP server:<br><action-text-attachment sgid="BAh7CEkiCGdpZAY6BkVUSSI7Z2lkOi8vZHluYWJsb2dnZXIvQWN0aXZlU3RvcmFnZTo6QmxvYi8xMzk5OT9leHBpcmVzX2luBjsAVEkiDHB1cnBvc2UGOwBUSSIPYXR0YWNoYWJsZQY7AFRJIg9leHBpcmVzX2F0BjsAVDA=--d3409a3647f9e04f48155403f80b2bfed0c4fe79" content-type="image/png" url="https://db.botta.me/static/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcTgyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--83081f086903c3b637806b48f5008b7dc1fdcab3/06.%20SMTP%20step%202.png" filename="06. SMTP step 2.png" filesize="42507" width="538" height="267" previewable="true" presentation="gallery"><figure class="attachment attachment--preview attachment--png"> <img src="https://cdn.dynablogger.com/static/representations/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBcTgyIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--83081f086903c3b637806b48f5008b7dc1fdcab3/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VY21WemFYcGxYM1J2WDJ4cGJXbDBXd2RwQWdBRWFRSUFBdz09IiwiZXhwIjpudWxsLCJwdXIiOiJ2YXJpYXRpb24ifX0=--62254c805d18962f1ac85d0730cb52228a017fca/06.%20SMTP%20step%202.png"> <figcaption class="attachment__caption"> <span class="attachment__name">06. SMTP step 2.png</span> <span class="attachment__size">41.5 KB</span> </figcaption> </figure></action-text-attachment><br><br><br>For Gmail, the host is <em>smtp.gmail.com</em> and of course you need to use your email and password. If you have 2FA activated on your Gmail account, you'll need to use an <a href="https://support.google.com/accounts/answer/185833?hl=en">app specific password</a> instead.<br><br>You also need to ensure Google's servers are allowed to send emails for your custom domain. So head to the DNS settings in Cloudflare, and edit the TXT record with the word <em>spf</em> in the content. You need to change it to the following value:<br><br> </div> <pre>v=spf1 include:_spf.mx.cloudflare.net include:_spf.google.com ~all</pre> <div> <br>Save and a wait a little while. From now on, emails send from Gmail using the alias will use Google's server to deliver the email but the email will appear as coming from the custom domain.<br><br>There's a little problem though. While this works great, some email clients will notice that the emails coming from your domain were actually sent from servers for another domain (Gmail's), and therefore will show a banner saying "sent via gmail.com" or similar next to your email address. Like I mentioned earlier, you can avoid this by using a provider for transactional email delivery configured to send emails from your custom domain correctly. Each provider's control panel will look different but the process is the same and typically involves creating a TXT DNS record for DKIM authentication, as well as adding the provider's servers to your SPF configuration. Some provider may take a couple of days to review your account to ensure you are not going to use them to send spam around.<br><br> </div> <h2>Migrating existing emails</h2> <div>If you were using the custom domain with email already before configuring Cloudflare routing, you may want to migrate all your past emails to the free Gmail/etc account you will now be using for storage. There's a nice tool for that called <a href="https://imapsync.lamiral.info/">imapsync</a>. Installing it is as simple as <br><br> </div> <pre>brew install imapsync</pre> <div> <br>on macOS but may require more steps for other operating systems. Check the docs for details on how to install.<br><br>Once installed, you can migrate emails from the old hosting service to the new one with the following command:<br><br> </div> <pre>imapsync --host1 imappro.zoho.eu --ssl1 --port1 993 --user1 "<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1a7f777b73765a796f696e75777e75777b7374">[email&#160;protected]</a>" --password1 "...." --host2 imap.gmail.com --ssl2 --port2 993 --user2 "<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2a5e4b584d4f5e4b4e4e584f59596a4d474b434604494547">[email&#160;protected]</a>" --password2 "..."</pre> <div> <br>Host1 is the source host (replace Zoho's IMAP server with the correct one for your previous provider), while host2 is the IMAP server for the free email account you will be using for storage. The migration will take quite a while, especially if you have many emails in the existing account, but the process shows a useful ETA while migrating so you know how long it's gonna roughly take.<br><br> </div> <h2>Configuring email clients</h2> <div>If you use a desktop/mobile app for emails instead of the browser, I recommend you configure the accounts as custom IMAP accounts even if for storage you use something like Gmail that can be configured more automatically. This is because this way you can use the Gmail address for authentication with the storage account, while using the custom domain address as sender address, and you can also configure the correct SMTP server. An alternative is to configure aliases instead, but not all clients support that. <br><br> </div> <h2>Conclusions</h2> <div>Like I mentioned in the beginning I am trying to cut costs with my paid subscriptions, so I was happy to see how well this solution works. It's easy to set up and it can cost literally zero if you use a free plan for the transactional email delivery. So if you host a few domains and want to save some bucks every month, it's an option worth considering. Let me know in the comments if you run into any issues with the setup and I'll be happy to help if I can.</div> </div> </section> <div class="w-full py-3 text-center text-1xl flex justify-between"> <div class="flex-1 text-left"> Previous: <a href="https://vitobotta.com/2022/06/18/scaling-rails-web-sockets-in-kubernetes-with-anycable/" class="link"> Scaling Rails web sockets in Kubernetes with AnyCable </a> </div> <div class="flex-1 text-right"> </div> </div> <h4 class="my-6 font-lg">Comments</h4> <div id="commento-wrapper"> <div id="commento"></div> </div> </article> </main> <div class="text-gray-700 min-h-screen flex-no-grow hidden lg:block sidebar lg:mr-8" id="sidebar"> <div class="px-6 lg:px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">The author</h3> <div class="pb-6 sm:text-lg"> <p class="mb-3"><img src="https://cdn.dynablogger.com/static/blobs/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBa1EwIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--ed31a3ccb9705508ddccba14ea551a2dbf9012a2/Headshot-80x80.jpeg" class="float-left mr-3">I am a passionate developer based in Espoo, Finland, where I work as Senior Backend Developer for event management platform <a href="https://www.brella.io/" target="_blank" class="underline font-semibold">Brella</a>.</p> <p class="mb-3">My roles as architect, coder and technology enthusiast overlap each other here on this web log.</p> <p class="mb-3">Unless otherwise noted, the views expressed on these pages are mine alone and not those of my employer.</p> <p class="mb-3">Thanks for stopping by. - Vito Botta</p> <a href="/about/" class="underline font-semibold">Learn more</a> </div> </div> <div class="mt-4 px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">Latest posts</h3> <ul class="list-none"> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/07/26/how-to-host-email-for-custom-domains-for-free-or-almost-free/"> How to host email for custom domains for free (or almost free) </a> </li> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/06/18/scaling-rails-web-sockets-in-kubernetes-with-anycable/"> Scaling Rails web sockets in Kubernetes with AnyCable </a> </li> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/03/11/self-hosting-nextcloud-with-dokku-and-s3-compatible-storage/"> Self-hosting Nextcloud with Dokku and s3 compatible storage </a> </li> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/02/27/free-ngrok-alternative-with-cloudflare-tunnels/"> Free Ngrok alternative with Cloudflare Tunnels </a> </li> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/02/16/deploying-an-app-with-dokku/"> Deploying an app with Dokku </a> </li> </ul> </div> <div class="mt-4 px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">Topics</h3> <div> <a class="link tag2" href="https://vitobotta.com/tags/hetzner-cloud/"> Hetzner Cloud </a> • <a class="link tag1" href="https://vitobotta.com/tags/tips/"> Tips </a> • <a class="link tag1" href="https://vitobotta.com/tags/self-hosting/"> self-hosting </a> • <a class="link tag2" href="https://vitobotta.com/tags/devops/"> devops </a> • <a class="link tag2" href="https://vitobotta.com/tags/google/"> Google </a> • <a class="link tag1" href="https://vitobotta.com/tags/productivity/"> productivity </a> • <a class="link tag1" href="https://vitobotta.com/tags/javascript/"> JavaScript </a> • <a class="link tag2" href="https://vitobotta.com/tags/blogging/"> blogging </a> • <a class="link tag2" href="https://vitobotta.com/tags/jekyll/"> Jekyll </a> • <a class="link tag1" href="https://vitobotta.com/tags/css/"> CSS </a> • <a class="link tag1" href="https://vitobotta.com/tags/apps/"> apps </a> • <a class="link tag3" href="https://vitobotta.com/tags/rancher/"> rancher </a> • <a class="link tag1" href="https://vitobotta.com/tags/postgresql/"> PostgreSQL </a> • <a class="link tag6" href="https://vitobotta.com/tags/ruby/"> Ruby </a> • <a class="link tag1" href="https://vitobotta.com/tags/digital-ocean/"> Digital Ocean </a> • <a class="link tag1" href="https://vitobotta.com/tags/sql-server/"> SQL Server </a> • <a class="link tag1" href="https://vitobotta.com/tags/ci-cd/"> CI/CD </a> • <a class="link tag1" href="https://vitobotta.com/tags/api/"> API </a> • <a class="link tag5" href="https://vitobotta.com/tags/ruby-on-rails/"> Ruby on Rails </a> • <a class="link tag1" href="https://vitobotta.com/tags/cloudflare/"> cloudflare </a> • <a class="link tag1" href="https://vitobotta.com/tags/web-design/"> Web Design </a> • <a class="link tag2" href="https://vitobotta.com/tags/testing/"> Testing </a> • <a class="link tag1" href="https://vitobotta.com/tags/vpn/"> VPN </a> • <a class="link tag1" href="https://vitobotta.com/tags/mobile/"> mobile </a> • <a class="link tag1" href="https://vitobotta.com/tags/performance/"> Performance </a> • <a class="link tag2" href="https://vitobotta.com/tags/mysql/"> MySQL </a> • <a class="link tag1" href="https://vitobotta.com/tags/dns/"> DNS </a> • <a class="link tag3" href="https://vitobotta.com/tags/linux/"> Linux </a> • <a class="link tag1" href="https://vitobotta.com/tags/nextcloud/"> nextcloud </a> • <a class="link tag2" href="https://vitobotta.com/tags/terraform/"> terraform </a> • <a class="link tag2" href="https://vitobotta.com/tags/docker/"> Docker </a> • <a class="link tag1" href="https://vitobotta.com/tags/backup/"> Backup </a> • <a class="link tag2" href="https://vitobotta.com/tags/wordpress/"> Wordpress </a> • <a class="link tag1" href="https://vitobotta.com/tags/email/"> email </a> • <a class="link tag1" href="https://vitobotta.com/tags/kvm/"> KVM </a> • <a class="link tag5" href="https://vitobotta.com/tags/programming/"> programming </a> • <a class="link tag2" href="https://vitobotta.com/tags/virtualisation/"> Virtualisation </a> • <a class="link tag1" href="https://vitobotta.com/tags/infrastructure/"> infrastructure </a> • <a class="link tag5" href="https://vitobotta.com/tags/kubernetes/"> kubernetes </a> • <a class="link tag3" href="https://vitobotta.com/tags/security/"> security </a> • <a class="link tag2" href="https://vitobotta.com/tags/storage/"> Storage </a> • <a class="link tag2" href="https://vitobotta.com/tags/apple/"> Apple </a> • <a class="link tag1" href="https://vitobotta.com/tags/nginx/"> Nginx </a> • <a class="link tag1" href="https://vitobotta.com/tags/system-administration/"> System Administration </a> • <a class="link tag1" href="https://vitobotta.com/tags/ansible/"> ansible </a> • <a class="link tag3" href="https://vitobotta.com/tags/databases/"> databases </a> • <a class="link tag2" href="https://vitobotta.com/tags/macos/"> macOS </a> </div> </div> <div class="mt-4 px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">License</h3> <div class="text-center"> <p class="italic"> "Any exposure is good for an artist." </p> <p class="mb-3"> - George Carlin </p> <p class="mb-3 w-full"> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" class="w-full text-center"> <img alt="Creative Commons Licence" style="border-width:0" class="mx-auto" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"> </a> <br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>. </p> </div> </div> <div class="mt-4 px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">Archives</h3> <ul class="list-none"> Liquid error: internal </ul> </div> </div> </div> <div class="uppercase py-8 w-full text-center"> © Vito Botta </div> <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://cdn.dynablogger.com/scripts/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/gGN4/instantpage.js" type="module"></script> <script>
  console.log(111);
</script> <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre').forEach((el) => {
          hljs.highlightElement(el);
        });
      });
    </script> </body> </html>