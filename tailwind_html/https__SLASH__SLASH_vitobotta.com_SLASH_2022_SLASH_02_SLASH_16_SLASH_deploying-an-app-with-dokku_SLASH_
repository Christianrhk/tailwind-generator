<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="UTF-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin> <link rel="preconnect" href="https://cdn.dynablogger.com" crossorigin> <link rel="preconnect" href="https://cdn.commento.io" crossorigin> <script defer data-domain="vitobotta.com" src="https://pl.skylinx.workers.dev/blah.js"></script> <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://vitobotta.com/feed.rss"> <link as="style" href="https://cdn.dynablogger.com/stylesheets/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/wA3w/karla.css" rel="preload"> <link href="https://cdn.dynablogger.com/stylesheets/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/wA3w/karla.css" media="print" onload="this.media='all'" rel="stylesheet"> <noscript> <link href="https://cdn.dynablogger.com/stylesheets/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/wA3w/karla.css" rel="stylesheet"> </noscript> <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.6.2/tailwind.min.css" rel="stylesheet"> <link href="https://cdn.dynablogger.com/stylesheets/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/Oby0/main.css" rel="stylesheet"> <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css" rel="stylesheet"> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script> <script defer src="https://commento.botta.me/js/commento.js"></script> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <title>Deploying an app with Dokku</title> <meta name="generator" content="DynaBlogger"> <meta name="author" content="Vito Botta"> <meta name="description" content="Dokku is an open source alternative to Heroku that enables the same easy deployments with " git push but with your own servers> <link rel="canonical" href="https://vitobotta.com/2022/02/16/deploying-an-app-with-dokku/"> <link rel="alternate" hreflang="en" href="https://vitobotta.com/2022/02/16/deploying-an-app-with-dokku/"> <link rel="alternate" hreflang="x-default" href="https://vitobotta.com/2022/02/16/deploying-an-app-with-dokku/"> <meta property="og:title" content="Deploying an app with Dokku"> <meta property="og:type" content="article"> <meta property="og:url" content="https://vitobotta.com/2022/02/16/deploying-an-app-with-dokku/"> <meta property="og:description" content="Dokku is an open source alternative to Heroku that enables the same easy deployments with " git push but with your own servers> <meta property="og:locale" content="en"> <meta property="og:site_name" content="has_many :codes"> <meta property="article:tag" content="devops"> <meta name="document_id" content="N13G"> <meta name="document_type" content="posts"> <link data-behaviour="comments" rel="stylesheet" href="https://cdn.dynablogger.com/comments/6M/01b373495c826b5f2dc31e0b9b13e640/stylesheet.css"> <script data-behaviour="comments" src="https://cdn.dynablogger.com/comments/6M/01b373495c826b5f2dc31e0b9b13e640/script.js"></script> </head> <body> <div class="w-full text-center px-8 py-4 bg-blue-600 text-white"> <div class="w-64 mx-auto flex items-center justify-center justify-between text-lg no-underline text-white"> <a class="hidden" href="#"> <svg aria-hidden="true" class="fab fa-facebook h-6 w-6" data-fa-i2svg="" data-icon="facebook" data-prefix="fab" focusable="false" role="img" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"> <path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z" fill="currentColor"></path> </svg> </a> <a class="hidden ml-4 lg:ml-6" href="#"> <svg aria-hidden="true" class="fab fa-instagram h-6 w-6" data-fa-i2svg="" data-icon="instagram" data-prefix="fab" focusable="false" role="img" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"> <path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z" fill="currentColor"></path> </svg> </a> <a class="ml-4 lg:ml-6" href="https://twitter.com/vitobotta" title="Twitter" target="_blank"> <svg aria-hidden="true" class="fab fa-twitter h-6 w-6" data-fa-i2svg="" data-icon="twitter" data-prefix="fab" focusable="false" role="img" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"> <path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" fill="currentColor"></path> </svg> </a> <a class="ml-4 lg:ml-6" href="https://www.linkedin.com/in/vitobotta/" title="LinkedIn" target="_blank"> <svg aria-hidden="true" class="h-6 w-6" data-fa-i2svg="" data-icon="linkedin" data-prefix="fab" focusable="false" role="img" viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"> <path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z" fill="currentColor"></path> </svg> </a> <a class="ml-4 lg:ml-6" href="https://github.com/vitobotta" title="Github" target="_blank"> <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewbox="-6.39108 -10.38875 55.38936 62.3325"><g fill="#fff"> <path d="M21.3035 0C9.5395 0 0 9.5373 0 21.3035c0 9.4122 6.1041 17.3976 14.5687 20.2146 1.0646.1972 1.4555-.4622 1.4555-1.0249 0-.5076-.0198-2.1861-.0289-3.9662-5.9266 1.2887-7.1772-2.5136-7.1772-2.5136-.9691-2.462-2.3654-3.1171-2.3654-3.1171-1.9329-1.3222.1457-1.295.1457-1.295 2.1392.1502 3.2656 2.1956 3.2656 2.1956 1.9001 3.2565 4.9837 2.315 6.1994 1.7706.1916-1.3765.7433-2.3167 1.3526-2.8487-4.7319-.5383-9.706-2.3653-9.706-10.5283 0-2.3255.8322-4.2259 2.195-5.7178-.2212-.537-.9504-2.7037.2067-5.638 0 0 1.789-.5723 5.8596 2.184 1.6994-.472 3.5218-.7088 5.3323-.7172 1.8104.008 3.6343.2451 5.3368.7172 4.0661-2.7563 5.8526-2.184 5.8526-2.184 1.1596 2.9343.4304 5.101.2092 5.638 1.366 1.4919 2.1921 3.3923 2.1921 5.7178 0 8.1827-4.9837 9.984-9.7275 10.5114.7642.6611 1.445 1.9576 1.445 3.9451 0 2.8505-.0243 5.1446-.0243 5.8462 0 .5673.3831 1.2316 1.463 1.0224 8.4603-2.8201 14.5566-10.8028 14.5566-20.212C42.6071 9.5372 33.0691 0 21.3036 0" fill-rule="evenodd"></path><path d="M8.0689 30.587c-.047.1061-.2135.1379-.3651.0649-.155-.0695-.2413-.2138-.1913-.32.046-.1087.2124-.139.367-.0663.1545.0695.2426.2152.1894.3214m.863.9625c-.1016.0942-.3006.0504-.435-.0984-.1397-.1485-.1655-.3475-.0624-.4427.1048-.0942.2974-.0501.4367.0984.1397.1503.1669.3475.0607.4427m.8399 1.2268c-.1305.091-.3443.006-.4763-.1834-.1305-.1898-.1305-.417.003-.508.132-.091.3426-.009.4763.1788.1302.1926.1302.4198-.003.5126m1.1506 1.1855c-.1167.1287-.3654.0942-.5475-.0815-.1862-.1718-.238-.4156-.1213-.5444.1185-.129.3686-.0928.552.0815.185.1715.241.417.1168.5444m1.5876.6882c-.052.167-.291.2424-.5324.1715-.241-.073-.3986-.268-.35-.4367.0502-.1683.2908-.247.5338-.1711.2406.0727.3987.2667.3486.4364m1.7435.1275c.006.1757-.1986.3214-.4519.3245-.2547.006-.461-.1365-.4639-.3094 0-.1774.2004-.3213.4547-.326.2533-.005.4611.1366.4611.3109m1.6223-.276c.0303.171-.1457.3471-.3972.394-.2473.0455-.4763-.0607-.5077-.2303-.0307-.1757.1482-.3517.3955-.3972.2519-.0437.4773.0593.5094.2335"></path></g> </svg> </a> <a class="ml-4 lg:ml-6" href="/feed.xml" title="Github" target="_blank"> <svg version="1.1" id="Layer_1" class="h-8 w-8 bg-blue-600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"> <g> <path style="fill:#FCFCFC;" d="M155.826,401.252c-24.856,0-45.078-20.222-45.078-45.078c0-24.856,20.222-45.078,45.078-45.078 s45.078,20.222,45.078,45.078C200.904,381.03,180.683,401.252,155.826,401.252z"></path> <path style="fill:#FCFCFC;" d="M249.878,387.908v-10.041c0-63.924-51.821-115.744-115.744-115.744h-10.041 c-1.223,0-2.214-0.992-2.214-2.214v-57.902c0-1.223,0.992-2.214,2.214-2.214h10.041c98.349,0,178.075,79.727,178.075,178.075 v10.041c0,1.223-0.992,2.214-2.214,2.214h-57.902C250.87,390.122,249.878,389.13,249.878,387.908z"></path> <path style="fill:#FCFCFC;" d="M361.183,387.908v-10.041c0-125.395-101.653-227.049-227.049-227.049h-10.041 c-1.223,0-2.214-0.992-2.214-2.214V90.701c0-1.223,0.992-2.214,2.214-2.214h12.255c76.705,0,148.818,29.87,203.057,84.108 c54.239,54.239,84.108,126.352,84.108,203.057v12.256c0,1.223-0.992,2.214-2.214,2.214h-57.902 C362.174,390.122,361.183,389.13,361.183,387.908z"></path> </g> </svg> </a> </div> </div> <div class="w-full text-center p-4 sm:p-8 bg-white"> <div class="text-4xl sm:text-5xl xl:text-6xl text-gray-800 font-semibold"> has_many :codes </div> <div class="mt-2 lg:mt-4 text-xl sm:text-2xl xl:text-3xl text-gray-600">Tips and walkthroughs on web technologies and digital life</div> </div> <div class="w-full text-center p-4 sm:p-8 bg-gray-200 border border-gray-300 border-l-0 border-r-0 mb-8 sm:text-xl"> <ul class="list-none mx-auto w-full max-w-lg flex justify-center flex-wrap"> <li> <a class="uppercase text-xl mx-6" href="/">Home</a> </li> <li> <a class="uppercase text-xl mx-6" href="https://vitobotta.com/about/">About</a> </li> <li> <a class="uppercase text-xl mx-6" href="https://vitobotta.com/geeky-cv/">Geeky CV</a> </li> <li> <a class="uppercase text-xl mx-6" href="https://vitobotta.com/search/">Search</a> </li> </ul> </div> <div class="flex text-lg justify-center"> <main class="px-4 sm:px-8 pb-4 sm:max-w-full w-full lg:max-w-3xl xl:max-w-4xl"> <article class="lg:mb-12 border border-gray-200 rounded shadow-lg p-6 bg-white"> <header> <span class="md:flex"> <div class="uppercase mb-2"> <a class="text-blue-500 text-sm sm:text-base lg:text-lg" href="https://vitobotta.com/tags/devops/">devops</a> </div> </span> <h1 class="mt-3 text-2xl sm:text-3xl xl:text-4xl flex items-center"> <a href="https://vitobotta.com/2022/02/16/deploying-an-app-with-dokku/" class="document-title font-semibold"> Deploying an app with Dokku </a> </h1> <div class="mt-4 flex justify-between"> <div class="text-gray-700 flex items-center text-base sm:text-lg"> <img src="https://cdn.dynablogger.com/static/blobs/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBdXcxIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--32dd40b68b9e9d86bb617ff9b756a850aa20cc59/calendar.png" class="hidden lg:block"> <div class="hidden lg:block ml-2 mt-1"> Published <time>Wednesday, Feb 16 2022</time> </div> </div> <div class="hidden lg:block"> <a href="#commento-wrapper" class="underline mt-1">Jump to comments</a> </div> </div> <div class="lg:hidden text-base sm:text-lg flex items-center"> <img src="https://cdn.dynablogger.com/static/blobs/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBdXcxIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--32dd40b68b9e9d86bb617ff9b756a850aa20cc59/calendar.png" class="mr-2"> Published   <time>Wednesday, Feb 16 2022</time> </div> </header> <section class="mt-8"> <p class="text-xl"> </p> <div class="trix-content"> <div>I've been using Kubernetes for a few years now for deployments also for my personal projects, but not long ago I shut down my paid blogging platform DynaBlogger (which I will open source at some point) and I am now the only user of the app, so a Kubernetes cluster - however small - is now overkill.<br><br>For this reason I decided to switch to <a href="https://dokku.com/">Dokku</a> for this app, since now a single node (that's a limitation with Dokku) and fewer resources are more than enough for the traffic of this blog alone. Dokku is an interesting open source alternative to commercial PaaS (Platform As A Service) like <a href="https://www.heroku.com/">Heroku</a>, and it allows for the same nice user experience with git-push based deployments, but with your own servers; therefore you can use instances with any provider of your choice and potentially save some good cash compared to Heroku, especially considering that you can deploy multiple applications on a single server. Dokku also supports a number of plugins and even the same "buildpacks" that Heroku uses to deploy the apps. It also performs deployments without causing any downtime, which is awesome.<br><br>In this post I will show what are the most important commands to set up an application with Dokku. For more details of course I recommend your read the docs. This will be a quick how-to. <br><br> </div> <div><br></div> <h2>Installation</h2> <div>Installing Dokku couldn't be easier, really. You just need to have a server already created, and run a bash script:<br><br> </div> <pre>wget https://raw.githubusercontent.com/dokku/dokku/v0.26.8/bootstrap.sh

sudo DOKKU_TAG=v0.26.8 bash bootstrap.sh</pre> <div> <br>At the moment of this writing the latest version is 0.26.8. The script will prepare the system by installing Nginx, Docker and deploying a bunch of utility containers. The installation only takes a few minutes. While the script sets up everything that Dokku needs, you still need to configure things like a firewall, SSH etc to harden the system. So don't skip those steps.<br><br> </div> <div><br></div> <h2>Global domain</h2> <div>You can configure multiple domains for each app, but you can also configure a wildcard domain name that will be used to generate default hostnames for your apps. All you need to do is configure a wildcard DNS record that points to the Dokku server. Then you need to add that global domain to Dokku's config:<br><br> </div> <pre>dokku domains:add-global apps.mydomain.com
dokku domains:report --global</pre> <div> <br>For now it is assumed that you run the "dokku" commands from the server. We'll see in a bit how you can run these commands directly from your local machine.<br><br> </div> <div><br></div> <h2>SSL/TLS certificates</h2> <div>Dokku can provision certificates for your apps automatically using Let's Encrypt, but this is not enabled out of the box. To enable it you need to install a plugin:<br><br> </div> <pre>dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git</pre> <div><br></div> <div><br></div> <h2>Setting up an application</h2> <div>The first step when setting up a new application is to create it:<br><br> </div> <pre>dokku apps:create myapp</pre> <div><br></div> <h3>Linking services</h3> <div>Like I mentioned above, Dokku supports a number of plugins that allow you to add things like databases to your apps. For example you can install a plugin for Postgres:<br><br> </div> <pre>dokku plugin:install https://github.com/dokku/dokku-postgres.git</pre> <div> <br>Then you can create a Postgres instance with:<br><br> </div> <pre>dokku postgres:create myapp-postgres</pre> <div> <br>And "link" this Postgres instance with your application:<br><br> </div> <pre>dokku postgres:link myapp-postgres myapp</pre> <div> <br>This last command will set up an environment variable for your app called <em>DATABASE_URL</em> which contains the URL of the database. All your app needs to do is to connect to the database using the URL in that env variable.<br><br>You will very likely want to schedule backups for your database, and the Postgres plugin supports backups to s3 compatible storage. For this to work, you first need to configure the credentials required to access the bucket:<br><br> </div> <pre>dokku postgres:backup-auth myapp-postgres &lt;access key&gt; &lt;secret key&gt; &lt;region&gt; v4 https://&lt;endpoint&gt;</pre> <div> <br>I typically use <a href="https://www.backblaze.com/b2/cloud-storage.html">Backblaze B2</a> for this since it's cheap but any s3 compatible object storage would do.<br><br>Then, to schedule for example a daily backup every morning at 5am:<br><br> </div> <pre>dokku postgres:backup-schedule myapp-postgres "0 5 * * *" myapp-postgres-backup </pre> <div> <br>The schedule is in the usual cron format; the last argument is the name of the bucket, which you need to create.  You can test a backup manually with the following command:<br><br> </div> <pre>dokku postgres:backup myapp-postgres myapp-postgres-backup </pre> <div> <br>You can also connect to the database with psql with the following command:<br><br> </div> <pre>dokku postgres:connect myapp-postgres</pre> <div> <br>Restores with the plugin are performed with pg_restore; if you need to restore an existing dump in plain SQL format, you can do that with this command:<br><br> </div> <pre>dokku postgres:connect myapp-postgres &lt; dump.sql</pre> <div> <br>There are several other plugins you can install and use. For example I use Redis for background jobs and websockets and memcached for caching. Just search "dokku &lt;service&gt;" to find the relevant plugin. Installing a plugin, creating an instance for the service it supports and linking it to an application works the same way with every plugin.<br><br> </div> <div><br></div> <h2>App configuration</h2> <div>The configuration for an application is done via environment variables. You can use the following command to set environment variables:<br><br> </div> <pre>dokku config myapp ENVIRONMENT_VARIABLE_NAME=value</pre> <div> <br>You can specify multiple environment variables with a single command. By default this command will restart the application so that the new configuration is applied right away. If you don't want to restart the application, you can add the <em>--no-restart </em>flag<em>.<br><br></em>You can view the whole configuration for your app at any time with:<br><br> </div> <pre>dokku config:show myapp</pre> <div><br></div> <div><br></div> <h2>Custom domains / issuing certificates</h2> <div>As mentioned before, Dokku assigns to each app a default hostname using the wildcard domain you have specified in the beginning, but you can also add one or more custom domains to your app:<br><br> </div> <pre>dokku domains:add myapp myapp.com </pre> <div> <br>Then, in order to have Dokku provision a certificate for the app's domains with Let's Encrypt you need to run:<br><br> </div> <pre>dokku letsencrypt:enable myapp</pre> <div> <br>I also recommend you schedule automatic renewal of certificates:<br><br> </div> <pre>dokku letsencrypt:cron-job --add</pre> <div> <br>This last command is for all applications.<br><br> </div> <div><br></div> <h2>Buildpacks</h2> <div>By default, Dokku will attempt to detect what kind of app you are deploying, and use the relevant buildpacks to make that happen. However at times you may need to tweak which buildpacks it should use; for example, DynaBlogger is a Rails 7 app that uses esbuild and for the assets to be built correctly I had to revert the order of the two buildpacks Dokku uses, ruby and nodejs, so that nodejs is used first:<br><br> </div> <pre>dokku buildpacks:clear myapp
dokku buildpacks:set myapp heroku/nodejs
dokku buildpacks:add myapp heroku/ruby</pre> <div><br></div> <div><br></div> <h2>Configuring git-push deployments</h2> <div>As with Heroku, you can configure an origin with the git repository of your app so that a deployment with Dokku is triggered each time you push new changes. First, you need to add your public SSH key to the <em>dokku</em> user on the server:<br><br> </div> <pre>echo &lt;your public key&gt;  | dokku ssh-keys:add admin</pre> <div> <br>Then you can add the origin:<br><br> </div> <pre>git remote add dokku <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="75111a1e1e0035">[email&#160;protected]</a>&lt;server ip or hostname&gt;:myapp</pre> <div> <br>I usually add two origins called <em>staging</em> and <em>production</em> for two environments, pointing to different instances of the app.<br><br>Now to trigger a deployment all you need is a <em>git push:<br></em><br> </div> <pre>git push dokku main</pre> <div> <br>Of course you can easily automate this with a CI pipeline.<br><br> </div> <div><br></div> <h2>Custom Dockerfile</h2> <div>Dokku actually builds a Docker image for your app behind the scenes, and it works just fine with most apps. You can, however, use a custom Dockerfile if you want more control on how the image is built or if, for example, you need some dependencies that are not installed by any of the buildpacks available. In order to build the image with a custom Dockerfile, just add the Dockerfile to the repo and run:<br><br> </div> <pre>dokku config:unset --no-restart myapp DOKKU_PROXY_PORT_MAP</pre> <div> <br>This will switch from buildpack-based deployment to Dockerfile-based deployment.<br><br>I also recommend you run the following on the server to use Builtkit:<br><br> </div> <pre>echo "export DOCKER_BUILDKIT=1" | sudo tee -a /etc/default/dokku
echo "export BUILDKIT_PROGRESS=plain" | sudo tee -a /etc/default/dokku</pre> <div><br></div> <div><br></div> <h2>Running commands in the context of an application</h2> <div>You can exec into a running application and run a command in its context with the <em>run</em> Dokku command. For example:<br><br> </div> <pre>dokku run myapp bash </pre> <div> <br>In this example, the bash shell will be executed if present.<br><br> </div> <div><br></div> <h2>Configuring multiple processes</h2> <div>Many applications require more than one process. For example, a web process for regular web traffic and a worker for background jobs. You can use a file named <em>Procfile</em> in the root of the repo to specify which processes you want to run. For example, for a typical Rails app I'd have this in the Procfile:<br><br> </div> <pre>web: bundle exec puma -Cconfig/puma.rb
worker: bundle exec sidekiq</pre> <div> <br><br> </div> <div><br></div> <h2>Scaling replicas</h2> <div>By default, Dokku starts a single replica only for the first process. If you want to change the number of replicas or ensure that one or more replicas are started also for the additional processes, you need the <em>ps:scale</em> command:<br><br> </div> <pre>dokku ps:scale myapp web=2 worker=1</pre> <div> <br><br> </div> <div><br></div> <h2>Tailing logs</h2> <div>You can view live logs for a deployment's process with this command:<br><br> </div> <pre>dokku logs myapp -t -p web</pre> <div> <br>The last argument is the name of the process whose logs you want to see.<br><br> </div> <div><br></div> <h2>Running dokku command from your local machine</h2> <div>You don't have to run <em>dokku</em> commands from the server. You can run them locally too. First you need to install the CLI - see <a href="https://dokku.com/docs/community/clients/">this page</a>. Then you need to configure SSH enabling tty connections, by adding the following to your <em>~/.ssh/config</em> file:<br><br> </div> <pre>Host apps
  HostName &lt;server IP&gt;
  User root
  RequestTTY force</pre> <div> <br>Then configure an alias in your shell so that the command <em>dokku</em> actually translates to <em>ssh -q apps dokku</em>. Now you should be able to run most commands from your local machine (there are a few exceptions, but the commands you will use most often run just fine over SSH).<br><br> </div> <div><br></div> <h2>Wrapping up</h2> <div>This was a very quick how-to with the basic commands you need to quickly set up an application with Dokku. Please refer to the official documentation if you want to learn more. I really like that it's as easy to use as Heroku (after a small setup upfront) and can be much, much cheaper.</div> </div> </section> <div class="w-full py-3 text-center text-1xl flex justify-between"> <div class="flex-1 text-left"> Previous: <a href="https://vitobotta.com/2022/02/02/data-anonymization-with-postgres/" class="link"> Data anonymization with Postgres </a> </div> <div class="flex-1 text-right"> Next: <a href="https://vitobotta.com/2022/02/27/free-ngrok-alternative-with-cloudflare-tunnels/" class="link"> Free Ngrok alternative with Cloudflare Tunnels </a> </div> </div> <h4 class="my-6 font-lg">Comments</h4> <div id="commento-wrapper"> <div id="commento"></div> </div> </article> </main> <div class="text-gray-700 min-h-screen flex-no-grow hidden lg:block sidebar lg:mr-8" id="sidebar"> <div class="px-6 lg:px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">The author</h3> <div class="pb-6 sm:text-lg"> <p class="mb-3"><img src="https://cdn.dynablogger.com/static/blobs/proxy/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBa1EwIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--ed31a3ccb9705508ddccba14ea551a2dbf9012a2/Headshot-80x80.jpeg" class="float-left mr-3">I am a passionate developer based in Espoo, Finland, where I work as Senior Backend Developer for event management platform <a href="https://www.brella.io/" target="_blank" class="underline font-semibold">Brella</a>.</p> <p class="mb-3">My roles as architect, coder and technology enthusiast overlap each other here on this web log.</p> <p class="mb-3">Unless otherwise noted, the views expressed on these pages are mine alone and not those of my employer.</p> <p class="mb-3">Thanks for stopping by. - Vito Botta</p> <a href="/about/" class="underline font-semibold">Learn more</a> </div> </div> <div class="mt-4 px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">Latest posts</h3> <ul class="list-none"> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/07/26/how-to-host-email-for-custom-domains-for-free-or-almost-free/"> How to host email for custom domains for free (or almost free) </a> </li> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/06/18/scaling-rails-web-sockets-in-kubernetes-with-anycable/"> Scaling Rails web sockets in Kubernetes with AnyCable </a> </li> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/03/11/self-hosting-nextcloud-with-dokku-and-s3-compatible-storage/"> Self-hosting Nextcloud with Dokku and s3 compatible storage </a> </li> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/02/27/free-ngrok-alternative-with-cloudflare-tunnels/"> Free Ngrok alternative with Cloudflare Tunnels </a> </li> <li class="py-1 bxorder border-r-0 border-0 border-t-0 mb-2"> <a class="link sm:text-lg" href="https://vitobotta.com/2022/02/16/deploying-an-app-with-dokku/"> Deploying an app with Dokku </a> </li> </ul> </div> <div class="mt-4 px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">Topics</h3> <div> <a class="link tag2" href="https://vitobotta.com/tags/hetzner-cloud/"> Hetzner Cloud </a> • <a class="link tag1" href="https://vitobotta.com/tags/tips/"> Tips </a> • <a class="link tag1" href="https://vitobotta.com/tags/self-hosting/"> self-hosting </a> • <a class="link tag2" href="https://vitobotta.com/tags/devops/"> devops </a> • <a class="link tag2" href="https://vitobotta.com/tags/google/"> Google </a> • <a class="link tag1" href="https://vitobotta.com/tags/productivity/"> productivity </a> • <a class="link tag1" href="https://vitobotta.com/tags/javascript/"> JavaScript </a> • <a class="link tag2" href="https://vitobotta.com/tags/blogging/"> blogging </a> • <a class="link tag2" href="https://vitobotta.com/tags/jekyll/"> Jekyll </a> • <a class="link tag1" href="https://vitobotta.com/tags/css/"> CSS </a> • <a class="link tag1" href="https://vitobotta.com/tags/apps/"> apps </a> • <a class="link tag3" href="https://vitobotta.com/tags/rancher/"> rancher </a> • <a class="link tag1" href="https://vitobotta.com/tags/postgresql/"> PostgreSQL </a> • <a class="link tag6" href="https://vitobotta.com/tags/ruby/"> Ruby </a> • <a class="link tag1" href="https://vitobotta.com/tags/digital-ocean/"> Digital Ocean </a> • <a class="link tag1" href="https://vitobotta.com/tags/sql-server/"> SQL Server </a> • <a class="link tag1" href="https://vitobotta.com/tags/ci-cd/"> CI/CD </a> • <a class="link tag1" href="https://vitobotta.com/tags/api/"> API </a> • <a class="link tag5" href="https://vitobotta.com/tags/ruby-on-rails/"> Ruby on Rails </a> • <a class="link tag1" href="https://vitobotta.com/tags/cloudflare/"> cloudflare </a> • <a class="link tag1" href="https://vitobotta.com/tags/web-design/"> Web Design </a> • <a class="link tag2" href="https://vitobotta.com/tags/testing/"> Testing </a> • <a class="link tag1" href="https://vitobotta.com/tags/vpn/"> VPN </a> • <a class="link tag1" href="https://vitobotta.com/tags/mobile/"> mobile </a> • <a class="link tag1" href="https://vitobotta.com/tags/performance/"> Performance </a> • <a class="link tag2" href="https://vitobotta.com/tags/mysql/"> MySQL </a> • <a class="link tag1" href="https://vitobotta.com/tags/dns/"> DNS </a> • <a class="link tag3" href="https://vitobotta.com/tags/linux/"> Linux </a> • <a class="link tag1" href="https://vitobotta.com/tags/nextcloud/"> nextcloud </a> • <a class="link tag2" href="https://vitobotta.com/tags/terraform/"> terraform </a> • <a class="link tag2" href="https://vitobotta.com/tags/docker/"> Docker </a> • <a class="link tag1" href="https://vitobotta.com/tags/backup/"> Backup </a> • <a class="link tag2" href="https://vitobotta.com/tags/wordpress/"> Wordpress </a> • <a class="link tag1" href="https://vitobotta.com/tags/email/"> email </a> • <a class="link tag1" href="https://vitobotta.com/tags/kvm/"> KVM </a> • <a class="link tag5" href="https://vitobotta.com/tags/programming/"> programming </a> • <a class="link tag2" href="https://vitobotta.com/tags/virtualisation/"> Virtualisation </a> • <a class="link tag1" href="https://vitobotta.com/tags/infrastructure/"> infrastructure </a> • <a class="link tag5" href="https://vitobotta.com/tags/kubernetes/"> kubernetes </a> • <a class="link tag3" href="https://vitobotta.com/tags/security/"> security </a> • <a class="link tag2" href="https://vitobotta.com/tags/storage/"> Storage </a> • <a class="link tag2" href="https://vitobotta.com/tags/apple/"> Apple </a> • <a class="link tag1" href="https://vitobotta.com/tags/nginx/"> Nginx </a> • <a class="link tag1" href="https://vitobotta.com/tags/system-administration/"> System Administration </a> • <a class="link tag1" href="https://vitobotta.com/tags/ansible/"> ansible </a> • <a class="link tag3" href="https://vitobotta.com/tags/databases/"> databases </a> • <a class="link tag2" href="https://vitobotta.com/tags/macos/"> macOS </a> </div> </div> <div class="mt-4 px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">License</h3> <div class="text-center"> <p class="italic"> "Any exposure is good for an artist." </p> <p class="mb-3"> - George Carlin </p> <p class="mb-3 w-full"> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" class="w-full text-center"> <img alt="Creative Commons Licence" style="border-width:0" class="mx-auto" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"> </a> <br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>. </p> </div> </div> <div class="mt-4 px-6 pt-6 pb-3 border border-gray-200 rounded shadow-lg bg-white"> <h3 class="font-semibold text-xl xl:text-2xl text-gray-700 mb-4">Archives</h3> <ul class="list-none"> Liquid error: internal </ul> </div> </div> </div> <div class="uppercase py-8 w-full text-center"> © Vito Botta </div> <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://cdn.dynablogger.com/scripts/6M/20220727180055629486-01b373495c826b5f2dc31e0b9b13e640/gGN4/instantpage.js" type="module"></script> <script>
  console.log(111);
</script> <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre').forEach((el) => {
          hljs.highlightElement(el);
        });
      });
    </script> </body> </html>